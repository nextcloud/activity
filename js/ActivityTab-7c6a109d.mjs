(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode("[data-v-beeadb85] .empty-content__icon span{background-size:64px;width:64px;height:64px}.activity__actions[data-v-beeadb85]{display:flex;flex-direction:column;width:100%}")),document.head.appendChild(e)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
/*! third party licenses: js/vendor.LICENSE.txt */
import{n as a,d as o,c as r}from"./index-76a58945-b4f193da.mjs";import{d as c,r as l,o as u,e as p,f as v,g as d,t as n}from"./index-ede745f2.mjs";import{A as f,p as g,v as y,g as m}from"./Activity-bf94a7f1.mjs";import{l as h}from"./logger-2ebf21a4.mjs";import{g as _}from"./ActivityAPI-3663b197.mjs";import{l as b}from"./activity-sidebar.mjs";import"./index-65a5f423.mjs";const A=c({__name:"ActivitySidebarPlugin",props:{plugin:null,fileInfo:null},emits:["reload-activities"],setup(t,{emit:i}){const e=t,s=l();return u(()=>e.plugin.mount(s.value,{context:p()?.proxy,fileInfo:e.fileInfo,reload:()=>i("reload-activities")})),v(()=>e.plugin.unmount()),{__sfc:!0,props:e,emit:i,attachTarget:s}}});var I=function(){var t=this,i=t._self._c;return t._self._setupProxy,i("div",{ref:"attachTarget"})},S=[],x=a(A,I,S,!1,null,null,null,null);const N=x.exports;const P={name:"ActivityTab",components:{Activity:f,NcEmptyContent:g,NcIconSvgWrapper:y,NcLoadingIcon:o,ActivitySidebarPlugin:N},data(){return{error:"",loading:!0,fileInfo:null,activities:[],lightningBoltSVG:b,sidebarPlugins:[]}},mounted(){this.sidebarPlugins=_()},methods:{async update(t){this.fileInfo=t,this.resetState(),await this.getActivities()},async getActivities(){try{this.loading=!0;const t=await r.get(d("apps/activity/api/v2/activity/filter"),{params:{format:"json",object_type:"files",object_id:this.fileInfo.id}});this.loading=!1,this.processActivities(t)}catch(t){if(t.response!==void 0&&t.response.status===304){this.loading=!1;return}this.error=n("activity","Unable to load the activity list"),this.loading=!1,console.error("Error loading the activity list",t)}},resetState(){this.loading=!0,this.error="",this.activities=[]},processActivities({data:t}){t.ocs&&t.ocs.data&&t.ocs.data.length>0&&(this.activities=t.ocs.data.map(i=>new m(i)).sort((i,e)=>e.timestamp-i.timestamp),h.debug(`Processed ${this.activities.length} activity(ies)`,{activities:this.activities,fileInfo:this.fileInfo}))},t:n}};var C=function(){var t=this,i=t._self._c;return i("div",{class:{"icon-loading":t.loading}},[t.error?i("NcEmptyContent",{attrs:{name:t.error},scopedSlots:t._u([{key:"icon",fn:function(){return[i("NcIconSvgWrapper",{attrs:{svg:t.lightningBoltSVG}})]},proxy:!0}],null,!1,63559581)}):[t.sidebarPlugins.length>0?i("div",{staticClass:"activity__actions"},t._l(t.sidebarPlugins,function(e,s){return i("ActivitySidebarPlugin",{key:s,attrs:{plugin:e,"file-info":t.fileInfo},on:{"reload-activities":function(j){return t.getActivities()}}})}),1):t._e(),t.loading?i("NcEmptyContent",{attrs:{name:t.t("activity","Loading activities")},scopedSlots:t._u([{key:"icon",fn:function(){return[i("NcLoadingIcon")]},proxy:!0}],null,!1,3085876643)}):t.activities.length===0?i("NcEmptyContent",{attrs:{name:t.t("activity","No activity yet")},scopedSlots:t._u([{key:"icon",fn:function(){return[i("span",{staticClass:"icon-activity"})]},proxy:!0}])}):i("ul",t._l(t.activities,function(e){return i("Activity",{key:e.id,attrs:{activity:e},on:{reload:function(s){return t.getActivities()}}})}),1)]],2)},k=[],E=a(P,C,k,!1,null,"beeadb85",null,null);const $=E.exports;export{$ as default};
