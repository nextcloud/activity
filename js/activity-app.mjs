(function(){"use strict";try{if(typeof document<"u"){var i=document.createElement("style");i.appendChild(document.createTextNode(".activity-group__heading[data-v-2cedecff]{line-height:1.5;margin-block:30px 12px}.activity-group__heading[data-v-2cedecff]:first-of-type{margin-block-start:0}.activity-app[data-v-9b1face9]{display:flex;flex-direction:column;overflow:hidden}.activity-app__empty-content[data-v-9b1face9]{height:100%}.activity-app__loading-indicator[data-v-9b1face9]{color:var(--color-text-maxcontrast);justify-self:center;margin-block:30px 6px;text-align:center}.activity-app__container[data-v-9b1face9]{display:flex;flex-direction:column;height:100%;width:min(100%,924px);max-width:924px;margin:0 auto;padding-inline:12px;overflow-y:scroll}.activity-app__heading[data-v-9b1face9]{font-weight:700;font-size:20px;line-height:44px;margin-top:1px;margin-inline:calc(2 * var(--app-navigation-padding, 8px) + 44px) var(--app-navigation-padding, 8px)}.app-activity .settings-link{max-width:100%}.app-activity .app-navigation-entry.active .navigation-icon{filter:var(--primary-invert-if-dark)}.app-activity .app-navigation-entry:not(.active) .navigation-icon{filter:var(--background-invert-if-dark)}.app-activity .navigation-icon{height:16px;width:16px}")),document.head.appendChild(i)}}catch(a){console.error("vite-plugin-css-injected-by-js",a)}})();
import{_ as nt,l as et,u as Ct,N as pt,a as Et,c as wt,v as Ht,b as Vt,d as Wt,e as zt,f as _t,g as Dt,h as Ot}from"./NcUserBubble-ChgvvPPf-DvK-B-Hh.chunk.mjs";import{d as X,r as jt,c as M,o as g,w as S,a as V,u as p,b as Nt,e as ot,n as J,f as $,g as kt,h as Pt,i as Rt,j as It,t as b,k as it,l as O,m as w,s as R,p as h,q as W,v as B,x as G,F as K,y as lt,z as Q,A as Bt,B as ft,C as Gt,D as $t}from"./preload-helper-CSVEMk8R.chunk.mjs";import{N as Ft,a as Ut,s as St,b as Zt,c as qt,d as Yt,e as Jt,f as Kt}from"./index-hZPKu-D6-frAbHWP0.chunk.mjs";import{m as U,_ as Qt,N as yt,A as Xt}from"./ActivityComponent.vue_vue_type_script_setup_true_lang-DEJdDvBu.chunk.mjs";import{l as at}from"./logger-Cy5VgVmS.chunk.mjs";import"./_commonjsHelpers-Cqwegr3R.chunk.mjs";const tt="activity";const te=X({__name:"ActivityApp",setup(t){return(i,e)=>{const s=jt("router-view");return g(),M(p(Ft),{"app-name":"activity"},{default:S(()=>[V(s,{name:"navigation"}),V(s)]),_:1})}}});function st(t,i){return Pt()?(Rt(t,i),!0):!1}const ee=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const At=t=>t!=null,ie=Object.prototype.toString,ae=t=>ie.call(t)==="[object Object]",E=()=>{};function Lt(t,i){function e(...s){return new Promise((l,r)=>{Promise.resolve(t(()=>i.apply(this,s),{fn:i,thisArg:this,args:s})).then(l).catch(r)})}return e}function ne(t,i={}){let e,s,l=E;const r=n=>{clearTimeout(n),l(),l=E};let c;return n=>{const o=b(t),u=b(i.maxWait);return e&&r(e),o<=0||u!==void 0&&u<=0?(s&&(r(s),s=void 0),Promise.resolve(n())):new Promise((a,m)=>{l=i.rejectOnCancel?m:a,c=n,u&&!s&&(s=setTimeout(()=>{e&&r(e),s=void 0,a(c())},u)),e=setTimeout(()=>{s&&r(s),s=void 0,a(n())},o)})}}function oe(...t){let i=0,e,s=!0,l=E,r,c,n,o,u;!It(t[0])&&typeof t[0]=="object"?{delay:c,trailing:n=!0,leading:o=!0,rejectOnCancel:u=!1}=t[0]:[c,n=!0,o=!0,u=!1]=t;const a=()=>{e&&(clearTimeout(e),e=void 0,l(),l=E)};return m=>{const v=b(c),y=Date.now()-i,f=()=>r=m();return a(),v<=0?(i=Date.now(),f()):(y>v?(i=Date.now(),(o||!s)&&f()):n&&(r=new Promise((_,A)=>{l=u?A:_,e=setTimeout(()=>{i=Date.now(),s=!0,_(f()),a()},Math.max(0,v-y))})),!o&&!e&&(e=setTimeout(()=>s=!0,v)),s=!1,r)}}function Z(t){return Array.isArray(t)?t:[t]}function Mt(t){return kt()}function le(t,i=200,e={}){return Lt(ne(i,e),t)}function se(t,i=200,e=!1,s=!0,l=!1){return Lt(oe(i,e,s,l),t)}function re(t,i=!0,e){Mt()?ot(t,e):i?t():J(t)}function ce(t,i){Mt()&&Nt(t,i)}function ue(t,i,e){return $(t,i,{...e,immediate:!0})}function ve(t,i,e){return $(t,i,{...e,once:!0})}const q=ee?window:void 0;function I(t){var i;const e=b(t);return(i=e?.$el)!==null&&i!==void 0?i:e}function ht(...t){const i=[],e=()=>{i.forEach(n=>n()),i.length=0},s=(n,o,u,a)=>(n.addEventListener(o,u,a),()=>n.removeEventListener(o,u,a)),l=w(()=>{const n=Z(b(t[0])).filter(o=>o!=null);return n.every(o=>typeof o!="string")?n:void 0}),r=ue(()=>{var n,o;return[(n=(o=l.value)===null||o===void 0?void 0:o.map(u=>I(u)))!==null&&n!==void 0?n:[q].filter(u=>u!=null),Z(b(l.value?t[1]:t[0])),Z(p(l.value?t[2]:t[1])),b(l.value?t[3]:t[2])]},([n,o,u,a])=>{if(e(),!n?.length||!o?.length||!u?.length)return;const m=ae(a)?{...a}:a;i.push(...n.flatMap(v=>o.flatMap(y=>u.map(f=>s(v,y,f,m)))))},{flush:"post"}),c=()=>{r(),e()};return st(e),c}function de(){const t=R(!1),i=kt();return i&&ot(()=>{t.value=!0},i),t}function Tt(t){const i=de();return w(()=>(i.value,!!t()))}function me(t,i,e={}){const{window:s=q,...l}=e;let r;const c=Tt(()=>s&&"MutationObserver"in s),n=()=>{r&&(r.disconnect(),r=void 0)},o=$(w(()=>{const m=Z(b(t)).map(I).filter(At);return new Set(m)}),m=>{n(),c.value&&m.size&&(r=new MutationObserver(i),m.forEach(v=>r.observe(v,l)))},{immediate:!0,flush:"post"}),u=()=>r?.takeRecords(),a=()=>{o(),n()};return st(a),{isSupported:c,stop:a,takeRecords:u}}function pe(t,i,e={}){const{root:s,rootMargin:l="0px",threshold:r=0,window:c=q,immediate:n=!0}=e,o=Tt(()=>c&&"IntersectionObserver"in c),u=w(()=>Z(b(t)).map(I).filter(At));let a=E;const m=R(n),v=o.value?$(()=>[u.value,I(s),m.value],([f,_])=>{if(a(),!m.value||!f.length)return;const A=new IntersectionObserver(i,{root:I(_),rootMargin:l,threshold:r});f.forEach(z=>z&&A.observe(z)),a=()=>{A.disconnect(),a=E}},{immediate:n,flush:"post"}):E,y=()=>{a(),v(),m.value=!1};return st(y),{isSupported:o,isActive:m,pause(){a(),m.value=!1},resume(){m.value=!0},stop:y}}function fe(t,i={}){const{window:e=q,scrollTarget:s,threshold:l=0,rootMargin:r,once:c=!1}=i,n=R(!1),{stop:o}=pe(t,u=>{let a=n.value,m=0;for(const v of u)v.time>=m&&(m=v.time,a=v.isIntersecting);n.value=a,c&&ve(n,()=>{o()})},{root:s,window:e,threshold:l,rootMargin:b(r)});return n}function ye(t){return typeof Window<"u"&&t instanceof Window?t.document.documentElement:typeof Document<"u"&&t instanceof Document?t.documentElement:t}const gt=1;function he(t,i={}){const{throttle:e=0,idle:s=200,onStop:l=E,onScroll:r=E,offset:c={left:0,right:0,top:0,bottom:0},observe:n={mutation:!1},eventListenerOptions:o={capture:!1,passive:!0},behavior:u="auto",window:a=q,onError:m=d=>{console.error(d)}}=i,v=typeof n=="boolean"?{mutation:n}:n,y=R(0),f=R(0),_=w({get(){return y.value},set(d){z(d,void 0)}}),A=w({get(){return f.value},set(d){z(void 0,d)}});function z(d,C){var k,N,P,F;if(!a)return;const L=b(t);if(!L)return;(k=L instanceof Document?a.document.body:L)===null||k===void 0||k.scrollTo({top:(N=b(C))!==null&&N!==void 0?N:A.value,left:(P=b(d))!==null&&P!==void 0?P:_.value,behavior:b(u)});const H=(L==null||(F=L.document)===null||F===void 0?void 0:F.documentElement)||L?.documentElement||L;_!=null&&(y.value=H.scrollLeft),A!=null&&(f.value=H.scrollTop)}const j=R(!1),T=it({left:!0,right:!1,top:!0,bottom:!1}),x=it({left:!1,right:!1,top:!1,bottom:!1}),rt=d=>{j.value&&(j.value=!1,x.left=!1,x.right=!1,x.top=!1,x.bottom=!1,l(d))},xt=le(rt,e+s),Y=d=>{var C;if(!a)return;const k=(d==null||(C=d.document)===null||C===void 0?void 0:C.documentElement)||d?.documentElement||I(d),{display:N,flexDirection:P,direction:F}=getComputedStyle(k),L=F==="rtl"?-1:1,H=k.scrollLeft;x.left=H<y.value,x.right=H>y.value;const ut=Math.abs(H*L)<=(c.left||0),vt=Math.abs(H*L)+k.clientWidth>=k.scrollWidth-(c.right||0)-gt;N==="flex"&&P==="row-reverse"?(T.left=vt,T.right=ut):(T.left=ut,T.right=vt),y.value=H;let D=k.scrollTop;d===a.document&&!D&&(D=a.document.body.scrollTop),x.top=D<f.value,x.bottom=D>f.value;const dt=Math.abs(D)<=(c.top||0),mt=Math.abs(D)+k.clientHeight>=k.scrollHeight-(c.bottom||0)-gt;N==="flex"&&P==="column-reverse"?(T.top=mt,T.bottom=dt):(T.top=dt,T.bottom=mt),f.value=D},ct=d=>{var C;a&&(Y((C=d.target.documentElement)!==null&&C!==void 0?C:d.target),j.value=!0,xt(d),r(d))};return ht(t,"scroll",e?se(ct,e,!0,!1):ct,o),re(()=>{try{const d=b(t);if(!d)return;Y(d)}catch(d){m(d)}}),v?.mutation&&t!=null&&t!==a&&t!==document&&me(t,()=>{const d=b(t);d&&Y(d)},{attributes:!0,childList:!0,subtree:!0}),ht(t,"scrollend",rt,o),{x:_,y:A,isScrolling:j,arrivedState:T,directions:x,measure(){const d=b(t);a&&d&&Y(d)}}}function ge(t,i,e={}){var s;const{direction:l="bottom",interval:r=100,canLoadMore:c=()=>!0}=e,n=it(he(t,{...e,offset:{[l]:(s=e.distance)!==null&&s!==void 0?s:0,...e.offset}})),o=O(),u=w(()=>!!o.value),a=w(()=>ye(b(t))),m=fe(a);function v(){if(n.measure(),!a.value||!m.value||!c(a.value))return;const{scrollHeight:y,clientHeight:f,scrollWidth:_,clientWidth:A}=a.value,z=l==="bottom"||l==="top"?y<=f:_<=A;(n.arrivedState[l]||z)&&(o.value||(o.value=Promise.all([i(n),new Promise(j=>setTimeout(j,r))]).finally(()=>{o.value=null,J(()=>v())})))}return ce($(()=>[n.arrivedState[l],m.value],v,{immediate:!0})),{isLoading:u,reset(){J(()=>v())}}}const be=["title"],we=X({__name:"ActivityGroup",props:{activities:{}},setup(t){const i=t,e=w(()=>{const l=U(),r=U().subtract(1,"day"),c=U(i.activities[0].datetime);return c.isSame(l,"day")?h("activity","Today"):c.isSame(r,"day")?h("activity","Yesterday"):c.format("LL")}),s=w(()=>{const l=U(i.activities[0].datetime).format("LL");return l!==e.value?l:void 0});return(l,r)=>(g(),W(K,null,[B("h2",{class:"activity-group__heading",title:s.value},G(e.value),9,be),B("ul",null,[(g(!0),W(K,null,lt(t.activities,c=>(g(),M(Qt,{key:c.id,activity:c,"show-previews":!0},null,8,["activity"]))),128))])],64))}}),_e=nt(we,[["__scopeId","data-v-2cedecff"]]),ke='<svg viewBox="0 0 32 32" height="32" width="32" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><path d="m8 22 1-7H4l9-13h2l-1 8h6L10 22H8Z" style="fill-rule:nonzero" transform="matrix(1.5 0 0 1.5 -2 -2)"/></svg>',Se={class:"activity-app__heading"},Ae={key:1,class:"activity-app__loading-indicator"},Le=X({__name:"ActivityAppFeed",props:{filter:{default:"all"}},setup(t){const i=et(tt,"navigationList"),e=Ct(),s=t,l=O(!1),r=O(!0),c=O([]),n=O(),o=O();ge(o,async()=>{r.value&&await m()},{distance:100});const u=w(()=>{const v={};for(const y of c.value){const f=U(y.datetime).format("LL");v[f]===void 0?v[f]=[y]:v[f].push(y)}return v}),a=w(()=>i.find(v=>v.id===e.params.filter).name);async function m(){if(!l.value)try{const v=n.value??"0";l.value=!0;const y=await wt.get(Ht("apps/activity/api/v2/activity/{filter}?format=json&previews=true&since={since}",{filter:s.filter,since:v}));c.value.push(...y.data.ocs.data.map(f=>new Xt(f))),n.value=y.headers["x-activity-last-given"],r.value=!0,J(async()=>{o.value&&o.value.clientHeight===o.value.scrollHeight&&await m()})}catch(v){if(Vt.isAxiosError(v)&&v.response?.status===304){r.value=!1;return}at.error(v),St(h("activity","Could not load activities"))}finally{l.value=!1}}return ot(()=>{m()}),$(s,()=>{c.value=[],n.value=void 0,m()}),(v,y)=>(g(),M(p(Ut),{class:"activity-app"},{default:S(()=>[B("h1",Se,G(a.value),1),r.value&&c.value.length===0?(g(),M(p(yt),{key:0,class:"activity-app__empty-content",name:p(h)("activity","Loading activities"),description:p(h)("activity","This stream will show events like additions, changes & shares")},{icon:S(()=>[V(p(pt),{size:36})]),_:1},8,["name","description"])):c.value.length===0?(g(),M(p(yt),{key:1,class:"activity-app__empty-content",name:p(h)("activity","No activity yet"),description:p(h)("activity","This stream will show events like additions, changes & shares")},{icon:S(()=>[V(p(Et),{svg:p(ke),size:36},null,8,["svg"])]),_:1},8,["name","description"])):Q("",!0),B("div",{ref_key:"container",ref:o,class:"activity-app__container"},[(g(!0),W(K,null,lt(u.value,(f,_)=>(g(),M(_e,{key:_,activities:f},null,8,["activities"]))),128)),r.value&&c.value.length>0?(g(),M(p(pt),{key:0,name:p(h)("activity","Loading more activities"),size:64,class:"activity-app__loading-indicator"},null,8,["name"])):!r.value&&c.value.length>0?(g(),W("div",Ae,G(p(h)("activity","No more activities.")),1)):Q("",!0)],512)]),_:1}))}}),Me=nt(Le,[["__scopeId","data-v-9b1face9"]]),Te={name:"ContentCopyIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},xe=["aria-hidden","aria-label"],Ce=["fill","width","height"],Ee={d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"},He={key:0};function Ve(t,i,e,s,l,r){return g(),W("span",Bt(t.$attrs,{"aria-hidden":e.title?null:"true","aria-label":e.title,class:"material-design-icon content-copy-icon",role:"img",onClick:i[0]||(i[0]=c=>t.$emit("click",c))}),[(g(),W("svg",{fill:e.fillColor,class:"material-design-icon__svg",width:e.size,height:e.size,viewBox:"0 0 24 24"},[B("path",Ee,[e.title?(g(),W("title",He,G(e.title),1)):Q("",!0)])],8,Ce))],16,xe)}const We=nt(Te,[["render",Ve]]),ze=["src"],De=X({__name:"ActivityAppNavigation",setup(t){const{rssLink:i,personalSettingsLink:e}=et(tt,"settings"),s=et(tt,"navigationList"),l=O(i),r=w(()=>!!l.value);async function c(){try{const{data:o}=await wt.post(_t("/apps/activity/settings/feed"),{enable:!r.value});l.value=o.data.rsslink}catch(o){St(h("activity","Could not enable RSS link")),at.error(o)}}async function n(){try{window.navigator.clipboard.writeText(l.value),Kt(h("activity","RSS link copied to clipboard"))}catch(o){at.debug(o),window.prompt(h("activity","Could not copy the RSS link, please copy manually:"),l.value)}}return(o,u)=>(g(),M(p(Jt),{"aria-label":p(h)("activity","Activity")},{list:S(()=>[(g(!0),W(K,null,lt(p(s),a=>(g(),M(p(Yt),{key:a.id,"data-navigation":a.id,to:a.id,name:a.name},Gt({_:2},[a.icon?{name:"icon",fn:S(()=>[B("img",{alt:"",src:a.icon,class:"navigation-icon",role:"presentation"},null,8,ze)]),key:"0"}:void 0]),1032,["data-navigation","to","name"]))),128))]),footer:S(()=>[V(p(Zt),{name:p(h)("activity","Activity settings")},{default:S(()=>[V(p(Wt),{type:"switch",modelValue:r.value,"onUpdate:modelValue":[u[0]||(u[0]=a=>r.value=a),c]},{default:S(()=>[ft(G(p(h)("activity","Enable RSS feed")),1)]),_:1},8,["modelValue"]),r.value?(g(),M(p(qt),{key:0,modelValue:l.value,"onUpdate:modelValue":u[1]||(u[1]=a=>l.value=a),label:p(h)("activity","RSS feed"),"show-trailing-button":!0,"trailing-button-label":p(h)("activity","Copy RSS feed link"),readonly:"readonly",onTrailingButtonClick:n},{"trailing-button-icon":S(()=>[V(We,{size:20})]),_:1},8,["modelValue","label","trailing-button-label"])):Q("",!0),V(p(zt),{class:"settings-link",href:p(e),title:p(h)("activity","Personal notification settings"),variant:"tertiary"},{default:S(()=>[ft(G(p(h)("activity","Personal notification settings")),1)]),_:1},8,["href","title"])]),_:1},8,["name"])]),_:1},8,["aria-label"]))}}),Oe=[{path:"/",name:"root",redirect:{path:"/all"}},{path:"/:filter?",components:{default:Me,navigation:De},props:{default:!0}}],je=Dt({history:Ot(_t("/apps/activity")),linkActiveClass:"active",routes:Oe}),bt=$t(te);bt.use(je),bt.mount("#content");
//# sourceMappingURL=activity-app.mjs.map
