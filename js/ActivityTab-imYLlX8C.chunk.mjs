(function(){"use strict";try{if(typeof document<"u"){var t=document.createElement("style");t.appendChild(document.createTextNode(".activity[data-v-2fda9824]{display:flex;flex-direction:column;overflow:hidden;height:100%}.activity__actions[data-v-2fda9824]{display:flex;flex-direction:column;width:100%}.activity__list[data-v-2fda9824]{flex-grow:1;overflow:scroll}.activity__empty-content[data-v-2fda9824]{height:100%}[data-v-2fda9824] .empty-content__icon span{background-size:64px;width:64px;height:64px}")),document.head.appendChild(t)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();
import{l as S}from"./activity-sidebar.mjs";import{k as w,b as N,g as C,h as L,f as R}from"./_plugin-vue_export-helper-Dd3HqztU.chunk.mjs";import{d as I,r as j,q as x,z as E,G,a as s,b as a,S as u,l as B,m as o,e as l,i as g,h as m,M as p,L as T,U as h,g as U,n as V}from"./translation-DoG5ZELJ-BZ4VBUO3.chunk.mjs";import{N as W,_ as q,A as z}from"./ActivityComponent.vue_vue_type_script_setup_true_lang-BUkWfIfb.chunk.mjs";import{g as M,a as D,b as _}from"./api-CnytGYOr.chunk.mjs";import{l as b}from"./logger-X0KjIiP2.chunk.mjs";import"./preload-helper-B9rAsR6N.chunk.mjs";import"./_commonjsHelpers-Cqwegr3R.chunk.mjs";const F=I({__name:"ActivitySidebarPlugin",props:{plugin:{},fileInfo:{}},emits:["reload-activities"],setup(i,{emit:t}){const e=i,n=t,v=j();return x(()=>{var r;return e.plugin.mount(v.value,{context:(r=E())==null?void 0:r.proxy,fileInfo:e.fileInfo,reload:()=>n("reload-activities")})}),G(()=>e.plugin.unmount()),(r,y)=>(a(),s("div",{ref_key:"attachTarget",ref:v},null,512))}}),H=I({name:"ActivityTab",components:{ActivityComponent:q,NcEmptyContent:W,NcIconSvgWrapper:N,NcLoadingIcon:w,ActivitySidebarPlugin:F},expose:["update"],data(){return{error:"",loading:!0,fileInfo:null,activities:[],lightningBoltSVG:S,sidebarPlugins:[]}},mounted(){this.sidebarPlugins=_()},methods:{async update(i){this.sidebarPlugins=[];const t=_();t.length>0&&B(()=>{this.sidebarPlugins=t}),this.fileInfo=i,this.resetState(),await this.getActivities()},async getActivities(){try{this.loading=!0;const i=await this.processActivities(await this.loadRealActivities()),t=await D({fileInfo:this.fileInfo});this.activities=[...i,...t].sort((e,n)=>n.timestamp-e.timestamp)}catch(i){this.error=u("activity","Unable to load the activity list"),b.error("Error loading the activity list",{error:i})}finally{this.loading=!1}},resetState(){this.loading=!0,this.error="",this.activities=[]},async loadRealActivities(){try{const{data:i}=await C.get(L("apps/activity/api/v2/activity/filter"),{params:{format:"json",object_type:"files",object_id:this.fileInfo.id}});return i.ocs.data}catch(i){if(i.response!==void 0&&i.response.status===304)return[];throw i}},processActivities(i){i=i.map(e=>new z(e)),b.debug("Processed ".concat(i.length," activity(ies)"),{activities:i,fileInfo:this.fileInfo});const t=M();return i.filter(e=>!t||t.every(n=>n(e)))},t:u}}),J={key:0,class:"activity__actions"},K={key:3,class:"activity__list"};function O(i,t,e,n,v,r){const y=o("NcIconSvgWrapper"),d=o("NcEmptyContent"),A=o("ActivitySidebarPlugin"),k=o("NcLoadingIcon"),P=o("ActivityComponent");return a(),s("div",{class:V([{"icon-loading":i.loading},"activity"])},[i.error||i.fileInfo===null?(a(),l(d,{key:0,name:i.error},{icon:g(()=>[m(y,{svg:i.lightningBoltSVG},null,8,["svg"])]),_:1},8,["name"])):(a(),s(p,{key:1},[i.sidebarPlugins.length>0?(a(),s("div",J,[(a(!0),s(p,null,h(i.sidebarPlugins,(c,f)=>(a(),l(A,{key:f,plugin:c,"file-info":i.fileInfo,onReloadActivities:t[0]||(t[0]=Q=>i.getActivities())},null,8,["plugin","file-info"]))),128))])):T("",!0),i.loading?(a(),l(d,{key:1,class:"activity__empty-content",name:i.t("activity","Loading activities")},{icon:g(()=>[m(k)]),_:1},8,["name"])):i.activities.length===0?(a(),l(d,{key:2,class:"activity__empty-content",name:i.t("activity","No activity yet")},{icon:g(()=>[...t[2]||(t[2]=[U("span",{class:"icon-activity"},null,-1)])]),_:1},8,["name"])):(a(),s("ul",K,[(a(!0),s(p,null,h(i.activities,c=>(a(),l(P,{key:c.id,activity:c,"show-previews":!1,onReload:t[1]||(t[1]=f=>i.getActivities())},null,8,["activity"]))),128))]))],64))],2)}const si=R(H,[["render",O],["__scopeId","data-v-2fda9824"]]);export{si as default};
//# sourceMappingURL=ActivityTab-imYLlX8C.chunk.mjs.map
