(function(){"use strict";try{if(typeof document<"u"){var t=document.createElement("style");t.appendChild(document.createTextNode(".activity[data-v-b6867024]{display:flex;flex-direction:column;overflow:hidden;height:100%}.activity__actions[data-v-b6867024]{display:flex;flex-direction:column;width:100%}.activity__list[data-v-b6867024]{flex-grow:1;overflow:scroll}.activity__empty-content[data-v-b6867024]{height:100%}[data-v-b6867024] .empty-content__icon span{background-size:64px;width:64px;height:64px}")),document.head.appendChild(t)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();
import{l as S}from"./activity-sidebar.mjs";import{m as k,b as N,h as j,j as I,g as C}from"./_plugin-vue_export-helper-BxQOJQGP.chunk.mjs";import{d as b,b as q,C as O,F as R,D as x,e as s,f as i,O as u,n as B,A as o,g as r,q as p,m as y,I as g,H as E,P as h,z as G}from"./translation-DoG5ZELJ-Ym572CAB.chunk.mjs";import{N as L,_ as V,A as T}from"./ActivityComponent.vue_vue_type_script_setup_true_lang-C1vMq-zN.chunk.mjs";import{g as W,a as z,b as D}from"./api-mFrM-9qG.chunk.mjs";import{l as f}from"./logger-1JHA8kGV.chunk.mjs";import"./preload-helper-DxYC2qmj.chunk.mjs";import"./index-NjYp13Ld.chunk.mjs";const F=b({__name:"ActivitySidebarPlugin",props:{plugin:{},node:{}},emits:["reload-activities"],setup(t,{emit:e}){const a=t,n=e,l=q();return O(()=>a.plugin.mount(l.value,{node:a.node,context:R()?.proxy??void 0,reload:()=>n("reload-activities")})),x(()=>a.plugin.unmount()),(_,d)=>(i(),s("div",{ref_key:"attachTarget",ref:l},null,512))}}),H=b({name:"ActivityTab",components:{ActivityComponent:V,NcEmptyContent:L,NcIconSvgWrapper:N,NcLoadingIcon:k,ActivitySidebarPlugin:F},props:{node:{type:Object,required:!0},folder:{type:Object,required:!1,default:void 0},view:{type:Object,required:!1,default:void 0}},expose:["update"],data(){return{error:"",loading:!0,activities:[],lightningBoltSVG:S,sidebarPlugins:[]}},watch:{node:{immediate:!0,async handler(){await this.update()}}},async mounted(){this.node&&await this.update()},methods:{async update(){this.sidebarPlugins=[];const t=D();t.length>0&&B(()=>{this.sidebarPlugins=t}),this.resetState(),await this.getActivities()},async getActivities(){try{this.loading=!0;const t=await this.processActivities(await this.loadRealActivities()),e=await z({node:this.node});this.activities=[...t,...e].sort((a,n)=>n.timestamp-a.timestamp)}catch(t){this.error=u("activity","Unable to load the activity list"),f.error("Error loading the activity list",{error:t})}finally{this.loading=!1}},resetState(){this.loading=!0,this.error="",this.activities=[]},async loadRealActivities(){try{const{data:t}=await j.get(I("apps/activity/api/v2/activity/filter"),{params:{format:"json",object_type:"files",object_id:this.node.fileid}});return t.ocs.data}catch(t){if(t.response!==void 0&&t.response.status===304)return[];throw t}},processActivities(t){t=t.map(a=>new T(a)),f.debug(`Processed ${t.length} activity(ies)`,{activities:t,node:this.node});const e=W();return t.filter(a=>!e||e.every(n=>n(a)))},t:u}}),U={key:0,class:"activity__actions"},$={key:3,class:"activity__list"};function J(t,e,a,n,l,_){const d=o("NcIconSvgWrapper"),v=o("NcEmptyContent"),A=o("ActivitySidebarPlugin"),w=o("NcLoadingIcon"),P=o("ActivityComponent");return i(),s("div",{class:G([{"icon-loading":t.loading},"activity"])},[t.error||!t.node?(i(),r(v,{key:0,name:t.error},{icon:p(()=>[y(d,{svg:t.lightningBoltSVG},null,8,["svg"])]),_:1},8,["name"])):(i(),s(g,{key:1},[t.sidebarPlugins.length>0?(i(),s("div",U,[(i(!0),s(g,null,h(t.sidebarPlugins,(c,m)=>(i(),r(A,{key:m,plugin:c,node:t.node,onReloadActivities:e[0]||(e[0]=K=>t.getActivities())},null,8,["plugin","node"]))),128))])):E("",!0),t.loading?(i(),r(v,{key:1,class:"activity__empty-content",name:t.t("activity","Loading activities")},{icon:p(()=>[y(w)]),_:1},8,["name"])):t.activities.length===0?(i(),r(v,{key:2,class:"activity__empty-content",name:t.t("activity","No activity yet")},{icon:p(()=>[y(d,{svg:t.lightningBoltSVG},null,8,["svg"])]),_:1},8,["name"])):(i(),s("ul",$,[(i(!0),s(g,null,h(t.activities,c=>(i(),r(P,{key:c.id,activity:c,"show-previews":!1,onReload:e[1]||(e[1]=m=>t.getActivities())},null,8,["activity"]))),128))]))],64))],2)}const at=C(H,[["render",J],["__scopeId","data-v-b6867024"]]);export{at as default};
//# sourceMappingURL=ActivityTab-EsQ7B4Vu.chunk.mjs.map
